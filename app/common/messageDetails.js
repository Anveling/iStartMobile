'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
var observable = require("data/observable");
var app = require("application");
var nativescript_loading_indicator_1 = require("nativescript-loading-indicator");
var frame = require("ui/frame");
var utils = require("utils/utils");
var web_view_1 = require("ui/web-view");
var appSettings = require("application-settings");
var page;
var context;
var closeCallback;
var loader = new nativescript_loading_indicator_1.LoadingIndicator();
var i = 1;
var pattern = new RegExp("^" +
    // protocol identifier
    "(?:(?:https?|ftp)://)" +
    // user:pass authentication
    "(?:\\S+(?::\\S*)?@)?" +
    "(?:" +
    // IP address exclusion
    // private & local networks
    "(?!(?:10|127)(?:\\.\\d{1,3}){3})" +
    "(?!(?:169\\.254|192\\.168)(?:\\.\\d{1,3}){2})" +
    "(?!172\\.(?:1[6-9]|2\\d|3[0-1])(?:\\.\\d{1,3}){2})" +
    // IP address dotted notation octets
    // excludes loopback network 0.0.0.0
    // excludes reserved space >= 224.0.0.0
    // excludes network & broacast addresses
    // (first & last IP address of each class)
    "(?:[1-9]\\d?|1\\d\\d|2[01]\\d|22[0-3])" +
    "(?:\\.(?:1?\\d{1,2}|2[0-4]\\d|25[0-5])){2}" +
    "(?:\\.(?:[1-9]\\d?|1\\d\\d|2[0-4]\\d|25[0-4]))" +
    "|" +
    // host name
    "(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)" +
    // domain name
    "(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*" +
    // TLD identifier
    "(?:\\.(?:[a-z\\u00a1-\\uffff]{2,}))" +
    // TLD may end with dot
    "\\.?" +
    ")" +
    // port number
    "(?::\\d{2,5})?" +
    // resource path
    "(?:[/?#]\\S*)?" +
    "$", "i");
var options = {
    message: 'Loading...',
    progress: 0.65,
    android: {
        intermediate: true,
        cancelable: false,
        max: 100,
        progressNumberFormat: "%1d/%2d",
        progressPercentFormat: 0.53,
        progressStyle: 1,
        secondaryProgress: 1
    },
    ios: {
        details: "Additional details note!",
        square: false,
        margin: 10,
        dimBackground: true,
        color: "#4B9ED6",
    }
};
var isItemVisible = false;
var singleAction = false;
var pageData = new observable.Observable();
var actionList;
function loaded(args) {
    page = args.object;
    var actionBar = page.getElementById("actionBar");
    var actionItem = actionBar.actionItems.getItemAt(0);
    actionItem.visibility = 'invisible';
    //loader.show();
    //console.log("temppage.onShownModally, context: " + page.navigationContext["content"]);
    context = page.navigationContext;
    var title = context["title"];
    var htmlString = context["data"];
    actionList = context["mobileActions"];
    pageData.set("title", title);
    pageData.set("isItemVisible", isItemVisible);
    pageData.set("singleAction", singleAction);
    pageData.set("htmlString", htmlString);
    page.bindingContext = pageData;
    //TODO: Need to fix this based on the new mobileActions format
    for (var i = 0; i < actionList.length; i++) {
        var actionText = actionList[i]["icon"] + " " + actionList[i]["label"];
        var bindingText = "actionLabel" + i;
        pageData.set(bindingText, actionList[i]["label"]);
        var iconText = "actionIcon" + i;
        pageData.set(iconText, actionList[i]["icon"]);
        var linkBtext = "actionLink" + i;
        pageData.set(linkBtext, actionList[i]["link"]);
        // console.log("Action Label " + actions[i]["label"]);
        // console.log(actions[i]["label"] && isItemVisible);
        // console.log(Boolean(actions[i]["label"] && isItemVisible));
    }
    if (actionList.length == 1) {
        pageData.set("singleAction", !pageData.get("singleAction"));
        var acLabelShow = page.getViewById("acLabelShow");
        acLabelShow.text = pageData.get("actionLabel0");
    }
    var webView = page.getViewById("msgWebView");
    if (app.android) {
        webView.android.getSettings().setBuiltInZoomControls(false);
        webView.android.getSettings().setMediaPlaybackRequiresUserGesture(false);
    }
    webView.on(web_view_1.WebView.loadFinishedEvent, function (args) {
        console.log(actionItem.visibility);
        var url = webView.src;
        if (pattern.test(url)) {
            actionItem.visibility = 'visible';
        }
    });
    /*setTimeout(function(){
      loader.hide();
    }, 1000);*/
}
exports.loaded = loaded;
function goBack() {
    frame.topmost().goBack();
}
exports.goBack = goBack;
function openBrowser() {
    var webView = page.getViewById("msgWebView");
    var url = webView.src;
    if (pattern.test(url)) {
        utils.openUrl(url);
    }
    else {
        console.log("Boolean: " + pattern.test(url));
        console.log(url);
    }
}
exports.openBrowser = openBrowser;
function showAction() {
    var actionDetails = page.getViewById("actionsDetails");
    var acStack0 = page.getViewById("acStack0");
    var acStack1 = page.getViewById("acStack1");
    var acStack2 = page.getViewById("acStack2");
    var acStack3 = page.getViewById("acStack3");
    acStack0.animate({
        opacity: 1,
        duration: 800
    });
    acStack1.animate({
        opacity: 1,
        duration: 800
    });
    acStack2.animate({
        opacity: 1,
        duration: 800
    });
    acStack3.animate({
        opacity: 1,
        duration: 800
    });
    pageData.set("isItemVisible", !pageData.get("isItemVisible"));
}
exports.showAction = showAction;
function moveTo(args) {
    console.log("This was clicked : " + args.object.acLink);
}
exports.moveTo = moveTo;
function closeMenu() {
    var acStack0 = page.getViewById("acStack0");
    var acStack1 = page.getViewById("acStack1");
    var acStack2 = page.getViewById("acStack2");
    var acStack3 = page.getViewById("acStack3");
    acStack0.animate({
        opacity: 0,
        duration: 800
    });
    acStack1.animate({
        opacity: 0,
        duration: 800
    });
    acStack2.animate({
        opacity: 0,
        duration: 800
    });
    acStack3.animate({
        opacity: 0,
        duration: 800
    });
    pageData.set("isItemVisible", !pageData.get("isItemVisible"));
}
exports.closeMenu = closeMenu;
function preparePayload1(methodName) {
    var objPay = new Object();
    objPay["sessionKey"] = appSettings.getString("sessionKey");
    objPay["idNumber"] = appSettings.getString("idNumber");
    objPay["deviceToken"] = appSettings.getString("deviceToken");
    objPay["method"] = methodName;
    var payLoad = JSON.stringify(objPay);
    //console.log("Payload --> " + payLoad);
    return objPay;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibWVzc2FnZURldGFpbHMuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlcyI6WyJtZXNzYWdlRGV0YWlscy50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUE7O0FBSVosNENBQThDO0FBRTlDLGlDQUFvQztBQUNwQyxpRkFBZ0U7QUFDaEUsZ0NBQW1DO0FBQ25DLG1DQUFxQztBQUNyQyx3Q0FBb0M7QUFLcEMsa0RBQXFEO0FBRXJELElBQUksSUFBZ0IsQ0FBQztBQUNyQixJQUFJLE9BQVksQ0FBQztBQUNqQixJQUFJLGFBQXVCLENBQUM7QUFDNUIsSUFBSSxNQUFNLEdBQUcsSUFBSSxpREFBZ0IsRUFBRSxDQUFDO0FBQ3BDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQztBQUVWLElBQUksT0FBTyxHQUFHLElBQUksTUFBTSxDQUNwQixHQUFHO0lBQ0gsc0JBQXNCO0lBQ3RCLHVCQUF1QjtJQUN2QiwyQkFBMkI7SUFDM0Isc0JBQXNCO0lBQ3RCLEtBQUs7SUFDSCx1QkFBdUI7SUFDdkIsMkJBQTJCO0lBQzNCLGtDQUFrQztJQUNsQywrQ0FBK0M7SUFDL0Msb0RBQW9EO0lBQ3BELG9DQUFvQztJQUNwQyxvQ0FBb0M7SUFDcEMsdUNBQXVDO0lBQ3ZDLHdDQUF3QztJQUN4QywwQ0FBMEM7SUFDMUMsd0NBQXdDO0lBQ3hDLDRDQUE0QztJQUM1QyxnREFBZ0Q7SUFDbEQsR0FBRztJQUNELFlBQVk7SUFDWiw0REFBNEQ7SUFDNUQsY0FBYztJQUNkLGdFQUFnRTtJQUNoRSxpQkFBaUI7SUFDakIscUNBQXFDO0lBQ3JDLHVCQUF1QjtJQUN2QixNQUFNO0lBQ1IsR0FBRztJQUNILGNBQWM7SUFDZCxnQkFBZ0I7SUFDaEIsZ0JBQWdCO0lBQ2hCLGdCQUFnQjtJQUNsQixHQUFHLEVBQUUsR0FBRyxDQUNQLENBQUM7QUFFSixJQUFJLE9BQU8sR0FBRztJQUNWLE9BQU8sRUFBRSxZQUFZO0lBQ3JCLFFBQVEsRUFBRSxJQUFJO0lBQ2QsT0FBTyxFQUFFO1FB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VTtJQUMzQixJQUFJLE1BQU0sR0FBRyxJQUFJLE1BQU0sRUFBRSxDQUFDO0lBQzFCLE1BQU0sQ0FBQyxZQUFZLENBQUMsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLFlBQVksQ0FBQyxDQUFDO0lBQzNELE1BQU0sQ0FBQyxVQUFVLENBQUMsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLFVBQVUsQ0FBQyxDQUFDO0lBQ3ZELE1BQU0sQ0FBQyxhQUFhLENBQUMsR0FBRyxXQUFXLENBQUMsU0FBUyxDQUFDLGFBQWEsQ0FBQyxDQUFDO0lBQzdELE1BQU0sQ0FBQyxRQUFRLENBQUMsR0FBRyxVQUFVLENBQUM7SUFDOUIsSUFBSSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxNQUFNLENBQUMsQ0FBQztJQUNyQyx3Q0FBd0M7SUFDeEMsTUFBTSxDQUFDLE1BQU0sQ0FBQztBQUN0QixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnXHJcblxyXG5pbXBvcnQgKiBhcyBwYWdlcyBmcm9tIFwidWkvcGFnZVwiO1xyXG5pbXBvcnQgKiBhcyB0ZXh0RmllbGQgZnJvbSBcInVpL3RleHQtZmllbGRcIjtcclxuaW1wb3J0ICogYXMgb2JzZXJ2YWJsZSBmcm9tIFwiZGF0YS9vYnNlcnZhYmxlXCI7XHJcbmltcG9ydCB7Vmlld30gZnJvbSBcInVpL2NvcmUvdmlld1wiO1xyXG5pbXBvcnQgYXBwID0gcmVxdWlyZShcImFwcGxpY2F0aW9uXCIpO1xyXG5pbXBvcnQge0xvYWRpbmdJbmRpY2F0b3J9IGZyb20gXCJuYXRpdmVzY3JpcHQtbG9hZGluZy1pbmRpY2F0b3JcIjtcclxuaW1wb3J0IGZyYW1lID0gcmVxdWlyZSgndWkvZnJhbWUnKTtcclxuaW1wb3J0ICogYXMgdXRpbHMgZnJvbSAndXRpbHMvdXRpbHMnO1xyXG5pbXBvcnQge1dlYlZpZXd9IGZyb20gJ3VpL3dlYi12aWV3JztcclxuaW1wb3J0IHtHcmlkTGF5b3V0LCBJdGVtU3BlY30gZnJvbSAndWkvbGF5b3V0cy9ncmlkLWxheW91dCc7XHJcbmltcG9ydCB7QnV0dG9ufSBmcm9tICd1aS9idXR0b24nO1xyXG5pbXBvcnQge0xhYmVsfSBmcm9tICd1aS9sYWJlbCc7XHJcbmltcG9ydCB7QWN0aW9uQmFyLCBBY3Rpb25JdGVtfSBmcm9tIFwidWkvYWN0aW9uLWJhclwiO1xyXG5pbXBvcnQgYXBwU2V0dGluZ3MgPSByZXF1aXJlKCdhcHBsaWNhdGlvbi1zZXR0aW5ncycpO1xyXG5cclxudmFyIHBhZ2U6IHBhZ2VzLlBhZ2U7XHJcbnZhciBjb250ZXh0OiBhbnk7XHJcbnZhciBjbG9zZUNhbGxiYWNrOiBGdW5jdGlvbjtcclxudmFyIGxvYWRlciA9IG5ldyBMb2FkaW5nSW5kaWNhdG9yKCk7IFxyXG52YXIgaSA9IDE7XHJcblxyXG52YXIgcGF0dGVybiA9IG5ldyBSZWdFeHAoXHJcbiAgICBcIl5cIiArXHJcbiAgICAvLyBwcm90b2NvbCBpZGVudGlmaWVyXHJcbiAgICBcIig/Oig/Omh0dHBzP3xmdHApOi8vKVwiICtcclxuICAgIC8vIHVzZXI6cGFzcyBhdXRoZW50aWNhdGlvblxyXG4gICAgXCIoPzpcXFxcUysoPzo6XFxcXFMqKT9AKT9cIiArXHJcbiAgICBcIig/OlwiICtcclxuICAgICAgLy8gSVAgYWRkcmVzcyBleGNsdXNpb25cclxuICAgICAgLy8gcHJpdmF0ZSAmIGxvY2FsIG5ldHdvcmtzXHJcbiAgICAgIFwiKD8hKD86MTB8MTI3KSg/OlxcXFwuXFxcXGR7MSwzfSl7M30pXCIgK1xyXG4gICAgICBcIig/ISg/OjE2OVxcXFwuMjU0fDE5MlxcXFwuMTY4KSg/OlxcXFwuXFxcXGR7MSwzfSl7Mn0pXCIgK1xyXG4gICAgICBcIig/ITE3MlxcXFwuKD86MVs2LTldfDJcXFxcZHwzWzAtMV0pKD86XFxcXC5cXFxcZHsxLDN9KXsyfSlcIiArXHJcbiAgICAgIC8vIElQIGFkZHJlc3MgZG90dGVkIG5vdGF0aW9uIG9jdGV0c1xyXG4gICAgICAvLyBleGNsdWRlcyBsb29wYmFjayBuZXR3b3JrIDAuMC4wLjBcclxuICAgICAgLy8gZXhjbHVkZXMgcmVzZXJ2ZWQgc3BhY2UgPj0gMjI0LjAuMC4wXHJcbiAgICAgIC8vIGV4Y2x1ZGVzIG5ldHdvcmsgJiBicm9hY2FzdCBhZGRyZXNzZXNcclxuICAgICAgLy8gKGZpcnN0ICYgbGFzdCBJUCBhZGRyZXNzIG9mIGVhY2ggY2xhc3MpXHJcbiAgICAgIFwiKD86WzEtOV1cXFxcZD98MVxcXFxkXFxcXGR8MlswMV1cXFxcZHwyMlswLTNdKVwiICtcclxuICAgICAgXCIoPzpcXFxcLig/OjE/XFxcXGR7MSwyfXwyWzAtNF1cXFxcZHwyNVswLTVdKSl7Mn1cIiArXHJcbiAgICAgIFwiKD86XFxcXC4oPzpbMS05XVxcXFxkP3wxXFxcXGRcXFxcZHwyWzAtNF1cXFxcZHwyNVswLTRdKSlcIiArXHJcbiAgICBcInxcIiArXHJcbiAgICAgIC8vIGhvc3QgbmFtZVxyXG4gICAgICBcIig/Oig/OlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XS0qKSpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rKVwiICtcclxuICAgICAgLy8gZG9tYWluIG5hbWVcclxuICAgICAgXCIoPzpcXFxcLig/OlthLXpcXFxcdTAwYTEtXFxcXHVmZmZmMC05XS0qKSpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZjAtOV0rKSpcIiArXHJcbiAgICAgIC8vIFRMRCBpZGVudGlmaWVyXHJcbiAgICAgIFwiKD86XFxcXC4oPzpbYS16XFxcXHUwMGExLVxcXFx1ZmZmZl17Mix9KSlcIiArXHJcbiAgICAgIC8vIFRMRCBtYXkgZW5kIHdpdGggZG90XHJcbiAgICAgIFwiXFxcXC4/XCIgK1xyXG4gICAgXCIpXCIgK1xyXG4gICAgLy8gcG9ydCBudW1iZXJcclxuICAgIFwiKD86OlxcXFxkezIsNX0pP1wiICtcclxuICAgIC8vIHJlc291cmNlIHBhdGhcclxuICAgIFwiKD86Wy8/I11cXFxcUyopP1wiICtcclxuICBcIiRcIiwgXCJpXCJcclxuICApO1xyXG5cclxudmFyIG9wdGlvbnMgPSB7ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAvL1BhcmFtZXRlcnMgZm9yIHRoZSBMb2FkaW5nIEluZGljYXRvciwgdGhlc2UgY2FuIGJlIHR3ZWFrZWQgYXMgcmVxdWlyZWQuXHJcbiAgICBtZXNzYWdlOiAnTG9hZGluZy4uLicsXHJcbiAgICBwcm9ncmVzczogMC42NSxcclxuICAgIGFuZHJvaWQ6IHtcclxuICAgICAgICBpbnRlcm1lZGlhdGU6IHRydWUsXHJcbiAgICAgICAgY2FuY2VsYWJsZTogZmFsc2UsXHJcbiAgICAgICAgbWF4OiAxMDAsXHJcbiAgICAgICAgcHJvZ3Jlc3NOdW1iZXJGb3JtYXQ6IFwiJTFkLyUyZFwiLFxyXG4gICAgICAgIHByb2dyZXNzUGVyY2VudEZvcm1hdDogMC41MyxcclxuICAgICAgICBwcm9ncmVzc1N0eWxlOiAxLFxyXG4gICAgICAgIHNlY29uZGFyeVByb2dyZXNzOiAxXHJcbiAgICB9LFxyXG4gICAgaW9zOiB7XHJcbiAgICAgICAgZGV0YWlsczogXCJBZGRpdGlvbmFsIGRldGFpbHMgbm90ZSFcIixcclxuICAgICAgICBzcXVhcmU6IGZhbHNlLFxyXG4gICAgICAgIG1hcmdpbjogMTAsXHJcbiAgICAgICAgZGltQmFja2dyb3VuZDogdHJ1ZSxcclxuICAgICAgICBjb2xvcjogXCIjNEI5RUQ2XCIsXHJcbiAgICB9XHJcbn07XHJcblxyXG52YXIgaXNJdGVtVmlzaWJsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG52YXIgc2luZ2xlQWN0aW9uOiBib29sZWFuID0gZmFsc2U7XHJcbnZhciBwYWdlRGF0YSA9IG5ldyBvYnNlcnZhYmxlLk9ic2VydmFibGUoKTtcclxudmFyIGFjdGlvbkxpc3Q7XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gbG9hZGVkKGFyZ3MpIHtcclxuICBwYWdlID0gPHBhZ2VzLlBhZ2U+YXJncy5vYmplY3Q7XHJcbiAgdmFyIGFjdGlvbkJhcjogQWN0aW9uQmFyID0gPEFjdGlvbkJhcj4gcGFnZS5nZXRFbGVtZW50QnlJZChcImFjdGlvbkJhclwiKTtcclxuICB2YXIgYWN0aW9uSXRlbTogQWN0aW9uSXRlbSA9IGFjdGlvbkJhci5hY3Rpb25JdGVtcy5nZXRJdGVtQXQoMCk7XHJcbiAgYWN0aW9uSXRlbS52aXNpYmlsaXR5ID0gJ2ludmlzaWJsZSc7XHJcbiAgLy9sb2FkZXIuc2hvdygpO1xyXG4gIC8vY29uc29sZS5sb2coXCJ0ZW1wcGFnZS5vblNob3duTW9kYWxseSwgY29udGV4dDogXCIgKyBwYWdlLm5hdmlnYXRpb25Db250ZXh0W1wiY29udGVudFwiXSk7XHJcbiAgY29udGV4dCA9IHBhZ2UubmF2aWdhdGlvbkNvbnRleHQ7XHJcbiAgdmFyIHRpdGxlID0gY29udGV4dFtcInRpdGxlXCJdO1xyXG4gIHZhciBodG1sU3RyaW5nID0gY29udGV4dFtcImRhdGFcIl07XHJcbiAgXHJcbiAgYWN0aW9uTGlzdCA9IGNvbnRleHRbXCJtb2JpbGVBY3Rpb25zXCJdO1xyXG4gIHBhZ2VEYXRhLnNldChcInRpdGxlXCIsIHRpdGxlKTtcclxuICBwYWdlRGF0YS5zZXQoXCJpc0l0ZW1WaXNpYmxlXCIsIGlzSXRlbVZpc2libGUpO1xyXG4gIHBhZ2VEYXRhLnNldChcInNpbmdsZUFjdGlvblwiLCBzaW5nbGVBY3Rpb24pO1xyXG4gIFxyXG4gIHBhZ2VEYXRhLnNldChcImh0bWxTdHJpbmdcIiwgaHRtbFN0cmluZyk7XHJcbiAgcGFnZS5iaW5kaW5nQ29udGV4dCA9IHBhZ2VEYXRhO1xyXG5cclxuICAvL1RPRE86IE5lZWQgdG8gZml4IHRoaXMgYmFzZWQgb24gdGhlIG5ldyBtb2JpbGVBY3Rpb25zIGZvcm1hdFxyXG4gIGZvciggdmFyIGkgPSAwOyBpIDwgYWN0aW9uTGlzdC5sZW5ndGg7IGkrKykge1xyXG4gICAgdmFyIGFjdGlvblRleHQ6U3RyaW5nID0gYWN0aW9uTGlzdFtpXVtcImljb25cIl0gK1wiIFwiKyBhY3Rpb25MaXN0W2ldW1wibGFiZWxcIl07XHJcbiAgICB2YXIgYmluZGluZ1RleHQgPSBcImFjdGlvbkxhYmVsXCIgKyBpO1xyXG4gICAgcGFnZURhdGEuc2V0KGJpbmRpbmdUZXh0LGFjdGlvbkxpc3RbaV1bXCJsYWJlbFwiXSk7XHJcbiAgICB2YXIgaWNvblRleHQgPSBcImFjdGlvbkljb25cIiArIGk7XHJcbiAgICBwYWdlRGF0YS5zZXQoaWNvblRleHQsYWN0aW9uTGlzdFtpXVtcImljb25cIl0pO1xyXG4gICAgdmFyIGxpbmtCdGV4dCA9IFwiYWN0aW9uTGlua1wiICsgaTtcclxuICAgIHBhZ2VEYXRhLnNldChsaW5rQnRleHQsIGFjdGlvbkxpc3RbaV1bXCJsaW5rXCJdKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKFwiQWN0aW9uIExhYmVsIFwiICsgYWN0aW9uc1tpXVtcImxhYmVsXCJdKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKGFjdGlvbnNbaV1bXCJsYWJlbFwiXSAmJiBpc0l0ZW1WaXNpYmxlKTtcclxuICAgIC8vIGNvbnNvbGUubG9nKEJvb2xlYW4oYWN0aW9uc1tpXVtcImxhYmVsXCJdICYmIGlzSXRlbVZpc2libGUpKTtcclxuICB9XHJcbiAgaWYgKGFjdGlvbkxpc3QubGVuZ3RoID09IDEpe1xyXG4gICAgcGFnZURhdGEuc2V0KFwic2luZ2xlQWN0aW9uXCIsICFwYWdlRGF0YS5nZXQoXCJzaW5nbGVBY3Rpb25cIikpO1xyXG4gICAgdmFyIGFjTGFiZWxTaG93OkxhYmVsID0gPExhYmVsPnBhZ2UuZ2V0Vmlld0J5SWQoXCJhY0xhYmVsU2hvd1wiKTtcclxuICAgIGFjTGFiZWxTaG93LnRleHQgPSBwYWdlRGF0YS5nZXQoXCJhY3Rpb25MYWJlbDBcIik7XHJcbiAgfVxyXG4gIHZhciB3ZWJWaWV3OiBXZWJWaWV3ID0gPFdlYlZpZXc+IHBhZ2UuZ2V0Vmlld0J5SWQoXCJtc2dXZWJWaWV3XCIpO1xyXG4gIGlmKGFwcC5hbmRyb2lkKSB7XHJcbiAgICB3ZWJWaWV3LmFuZHJvaWQuZ2V0U2V0dGluZ3MoKS5zZXRCdWlsdEluWm9vbUNvbnRyb2xzKGZhbHNlKTtcclxuICAgIHdlYlZpZXcuYW5kcm9pZC5nZXRTZXR0aW5ncygpLnNldE1lZGlhUGxheWJhY2tSZXF1aXJlc1VzZXJHZXN0dXJlKGZhbHNlKTtcclxuICB9XHJcblxyXG4gIHdlYlZpZXcub24oV2ViVmlldy5sb2FkRmluaXNoZWRFdmVudCwgZnVuY3Rpb24oYXJnczogYW55KXtcclxuICAgIGNvbnNvbGUubG9nKGFjdGlvbkl0ZW0udmlzaWJpbGl0eSk7XHJcbiAgICB2YXIgdXJsID0gd2ViVmlldy5zcmM7XHJcbiAgICBpZiAocGF0dGVybi50ZXN0KHVybCkpe1xyXG4gICAgICAgIGFjdGlvbkl0ZW0udmlzaWJpbGl0eSA9ICd2aXNpYmxlJzsgXHJcbiAgICB9XHJcbiAgfSk7XHJcblxyXG4gIC8qc2V0VGltZW91dChmdW5jdGlvbigpe1xyXG4gICAgbG9hZGVyLmhpZGUoKTtcclxuICB9LCAxMDAwKTsqL1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gZ29CYWNrKCkge1xyXG4gICAgZnJhbWUudG9wbW9zdCgpLmdvQmFjaygpO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gb3BlbkJyb3dzZXIoKSB7XHJcbiAgdmFyIHdlYlZpZXc6IFdlYlZpZXcgPSA8V2ViVmlldz4gcGFnZS5nZXRWaWV3QnlJZChcIm1zZ1dlYlZpZXdcIik7XHJcbiAgdmFyIHVybCA9ICB3ZWJWaWV3LnNyYztcclxuICBcclxuICBpZiAocGF0dGVybi50ZXN0KHVybCkpe1xyXG4gICAgdXRpbHMub3BlblVybCh1cmwpO1xyXG4gIH1lbHNle1xyXG4gICAgY29uc29sZS5sb2coXCJCb29sZWFuOiBcIiArIHBhdHRlcm4udGVzdCh1cmwpKVxyXG4gICAgY29uc29sZS5sb2codXJsKTtcclxuICB9XHJcbn1cclxuXHJcbmV4cG9ydCBmdW5jdGlvbiBzaG93QWN0aW9uKCkge1xyXG4gIHZhciBhY3Rpb25EZXRhaWxzOkdyaWRMYXlvdXQgPSA8R3JpZExheW91dD4gcGFnZS5nZXRWaWV3QnlJZChcImFjdGlvbnNEZXRhaWxzXCIpO1xyXG4gIFxyXG4gIHZhciBhY1N0YWNrMDpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2swXCIpO1xyXG4gIHZhciBhY1N0YWNrMTpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2sxXCIpO1xyXG4gIHZhciBhY1N0YWNrMjpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2syXCIpO1xyXG4gIHZhciBhY1N0YWNrMzpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2szXCIpO1xyXG4gIGFjU3RhY2swLmFuaW1hdGUoe1xyXG4gICAgb3BhY2l0eTogMSxcclxuICAgIGR1cmF0aW9uOiA4MDBcclxuICB9KTtcclxuICBhY1N0YWNrMS5hbmltYXRlKHtcclxuICAgIG9wYWNpdHk6IDEsXHJcbiAgICBkdXJhdGlvbjogODAwXHJcbiAgfSk7XHJcbiAgYWNTdGFjazIuYW5pbWF0ZSh7XHJcbiAgICBvcGFjaXR5OiAxLFxyXG4gICAgZHVyYXRpb246IDgwMFxyXG4gIH0pO1xyXG4gIGFjU3RhY2szLmFuaW1hdGUoe1xyXG4gICAgb3BhY2l0eTogMSxcclxuICAgIGR1cmF0aW9uOiA4MDBcclxuICB9KTtcclxuICBwYWdlRGF0YS5zZXQoXCJpc0l0ZW1WaXNpYmxlXCIsICFwYWdlRGF0YS5nZXQoXCJpc0l0ZW1WaXNpYmxlXCIpKTtcclxufVxyXG5cclxuZXhwb3J0IGZ1bmN0aW9uIG1vdmVUbyhhcmdzKSB7XHJcbiAgY29uc29sZS5sb2coXCJUaGlzIHdhcyBjbGlja2VkIDogXCIgKyBhcmdzLm9iamVjdC5hY0xpbmspO1xyXG59XHJcblxyXG5leHBvcnQgZnVuY3Rpb24gY2xvc2VNZW51KCkge1xyXG4gIHZhciBhY1N0YWNrMDpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2swXCIpO1xyXG4gIHZhciBhY1N0YWNrMTpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2sxXCIpO1xyXG4gIHZhciBhY1N0YWNrMjpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2syXCIpO1xyXG4gIHZhciBhY1N0YWNrMzpWaWV3ID0gPFZpZXc+cGFnZS5nZXRWaWV3QnlJZChcImFjU3RhY2szXCIpO1xyXG4gIGFjU3RhY2swLmFuaW1hdGUoe1xyXG4gICAgb3BhY2l0eTogMCxcclxuICAgIGR1cmF0aW9uOiA4MDBcclxuICB9KTtcclxuICBhY1N0YWNrMS5hbmltYXRlKHtcclxuICAgIG9wYWNpdHk6IDAsXHJcbiAgICBkdXJhdGlvbjogODAwXHJcbiAgfSk7XHJcbiAgYWNTdGFjazIuYW5pbWF0ZSh7XHJcbiAgICBvcGFjaXR5OiAwLFxyXG4gICAgZHVyYXRpb246IDgwMFxyXG4gIH0pO1xyXG4gIGFjU3RhY2szLmFuaW1hdGUoe1xyXG4gICAgb3BhY2l0eTogMCxcclxuICAgIGR1cmF0aW9uOiA4MDBcclxuICB9KTtcclxuICBwYWdlRGF0YS5zZXQoXCJpc0l0ZW1WaXNpYmxlXCIsICFwYWdlRGF0YS5nZXQoXCJpc0l0ZW1WaXNpYmxlXCIpKTtcclxufVxyXG5cclxuZnVuY3Rpb24gcHJlcGFyZVBheWxvYWQxKG1ldGhvZE5hbWUpIHtcclxuICAgICAgICB2YXIgb2JqUGF5ID0gbmV3IE9iamVjdCgpO1xyXG4gICAgICAgIG9ialBheVtcInNlc3Npb25LZXlcIl0gPSBhcHBTZXR0aW5ncy5nZXRTdHJpbmcoXCJzZXNzaW9uS2V5XCIpO1xyXG4gICAgICAgIG9ialBheVtcImlkTnVtYmVyXCJdID0gYXBwU2V0dGluZ3MuZ2V0U3RyaW5nKFwiaWROdW1iZXJcIik7XHJcbiAgICAgICAgb2JqUGF5W1wiZGV2aWNlVG9rZW5cIl0gPSBhcHBTZXR0aW5ncy5nZXRTdHJpbmcoXCJkZXZpY2VUb2tlblwiKTtcclxuICAgICAgICBvYmpQYXlbXCJtZXRob2RcIl0gPSBtZXRob2ROYW1lO1xyXG4gICAgICAgIHZhciBwYXlMb2FkID0gSlNPTi5zdHJpbmdpZnkob2JqUGF5KTtcclxuICAgICAgICAvL2NvbnNvbGUubG9nKFwiUGF5bG9hZCAtLT4gXCIgKyBwYXlMb2FkKTtcclxuICAgICAgICByZXR1cm4gb2JqUGF5O1xyXG59Il19